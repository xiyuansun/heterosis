CC=nvcc
CCFLAGS=-c -Iinclude/gpu -arch=sm_20
LDFLAGS= -lm

SRCDIR=src/
OBJDIR=obj/
BINDIR=bin/
BIN=$(BINDIR)gpu-mcmc

DEP=getopts readGrp readData config  
DEP+=printArrays printConfig printChain printHeaders
DEP+=allocChain newChain runChain resetChain freeChain
DEP+=runiform rnormal rgamma rbeta
DEP+=phi alp del phiAlpDelJoint phiAlpDel
DEP+=c sigC eta d tau eps
DEP+=thePhi theAlp theDel
DEP+=sigPhi sigAlp sigDel
DEP+=piAlp piDel
DEP+=interimResults summarizeChain
DEP+=updateDICprep dic
DEP+=mcmc main
DEP+=chainDeviceToHost

OBJ=$(foreach name, $(DEP), $(OBJDIR)$(name).o)
SRC=$(foreach name, $(DEP), $(OBJDIR)$(name).cu)

all: $(BIN)

$(BIN): $(OBJ) 
	$(CC) $(OBJ) $(LDFLAGS) -o $(BIN) 

$(OBJ): $(SRC) dirs
	$(NVCC) $(NVCCFLAGS) $< -o $@ 

.INTERMEDIATE: dirs

dirs:
	mkdir -p $(BINDIR)
	mkdir -p $(OBJDIR)

clean:
	rm -rf $(OBJDIR)
	rm -rf $(BINDIR)