CC=gcc
CCFLAGS=-c -Wall -pedantic -I../include/cpu
LDFLAGS=-lm

SRCDIR=cpu/
OBJDIR=../obj/
BINDIR=../bin/
RBINDIR=../inst/bin/

BINNAME=heterosis
BIN=$(BINDIR)$(BINNAME)
RBIN=$(RBINDIR)$(BINNAME)

DEP=getopts readGrp readData config  
DEP+=printArrays printConfig printChain printHeaders
DEP+=allocChain newChain runChain resetChain freeChain
DEP+=runiform rnormal rgamma rbeta
DEP+=phi alp del phiAlpDelJoint phiAlpDel
DEP+=c sigC eta d tau eps
DEP+=thePhi theAlp theDel
DEP+=sigPhi sigAlp sigDel
DEP+=piAlp piDel
DEP+=interimResults summarizeChain
DEP+=updateDICprep dic
DEP+=mcmc main
DEP+=mu logLik

OBJ=$(foreach name, $(DEP), $(OBJDIR)$(name).o)

all: $(BIN) $(RBIN)
	
$(BIN): $(OBJ) 
	$(CC) $(OBJ) $(LDFLAGS) -o $(BIN) 
	cp $(BIN) $(RBIN)

$(OBJDIR)%.o: $(SRCDIR)%.c dirs
	$(CC) $(CCFLAGS) $< -o $@ 

.INTERMEDIATE: dirs

dirs:
	mkdir -p $(OBJDIR)
	mkdir -p $(BINDIR)
	mkdir -p $(RBINDIR)

clean:
	rm -rf $(OBJDIR)
	rm -rf $(BINDIR)
	rm -rf $(RBINDIR)
